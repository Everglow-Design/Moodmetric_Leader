<!DOCTYPE html>
<html lang="da">
<head>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <meta charset="UTF-8">
    <title>Segmentering / Teams</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="dashboard-container" style="position: relative;">
        <button class="menu-btn" id="menuBtn" aria-label="Åbn menu">☰</button>
        <nav class="side-menu" id="sideMenu">
            <a href="ledelse.html">Dashboard</a>
            <a href="analyse.html">Analyse</a>
            <a href="segmentering.html">Segmentering</a>
            <a href="advarsler.html">Advarsler</a>
            <a href="brugere.html">Bruger-adgang</a>
            <a href="rapporter.html">Rapporter</a>
            <a href="index.html">Log ud</a>
        </nav>
        <h1>Segmentering / Teams</h1>
        <p>Afdelinger, teams, sammenligning (uden persondata).</p>
        <div id="segmentering-indhold">Her kommer segmenterings- og teamdata.</div>
            <section class="section" style="margin-top: 24px;">
                <h2>Opret team/afdeling</h2>
                <form id="createTeamForm" style="margin-bottom: 18px;">
                    <input type="text" id="teamName" placeholder="Teamnavn" required style="padding: 6px;">
                    <button type="submit">Opret</button>
                </form>
                <div id="teamList"></div>
            </section>
            <section class="section">
                <h2>Tildel medarbejdere til team</h2>
                <form id="assignForm" style="margin-bottom: 18px;">
                    <select id="teamSelect"></select>
                    <input type="text" id="employeeName" placeholder="Medarbejdernavn" required style="padding: 6px;">
                    <button type="submit">Tildel</button>
                </form>
                <div id="teamMembers"></div>
            </section>
            <section class="section">
                <h2>Aggregerede data pr. team</h2>
                <div id="teamData"></div>
            </section>
            <section class="section">
                <h2>Sammenlign teams</h2>
                <form id="compareTeamsForm" style="margin-bottom: 18px;">
                    <select id="compareTeam1"></select>
                    <select id="compareTeam2"></select>
                    <button type="submit">Sammenlign</button>
                </form>
                <div id="compareResult"></div>
            </section>
    </div>
    <script>
                // Supabase setup
                const SUPABASE_URL = 'https://rwksvrxfsjfdikckwmzq.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ3a3N2cnhmc2pmZGlrY2t3bXpxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczOTY5MTksImV4cCI6MjA4Mjk3MjkxOX0.rddfbx0API_R62uLWJdM5QCMmqIwc-9b6XpgfNsbsOk';
                const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

                // Load teams and members
                async function loadTeams() {
                    const { data: teams } = await _supabase.from('TEAMS').select('*').order('id');
                    const teamList = document.getElementById('teamList');
                    const teamSelect = document.getElementById('teamSelect');
                    const compareTeam1 = document.getElementById('compareTeam1');
                    const compareTeam2 = document.getElementById('compareTeam2');
                    teamList.innerHTML = '';
                    teamSelect.innerHTML = '';
                    compareTeam1.innerHTML = '';
                    compareTeam2.innerHTML = '';
                    if (teams && teams.length) {
                        teams.forEach(team => {
                            const li = document.createElement('div');
                            li.textContent = team.navn;
                            teamList.appendChild(li);
                            // Dropdowns
                            const opt1 = document.createElement('option');
                            opt1.value = team.id;
                            opt1.textContent = team.navn;
                            teamSelect.appendChild(opt1);
                            const opt2 = document.createElement('option');
                            opt2.value = team.id;
                            opt2.textContent = team.navn;
                            compareTeam1.appendChild(opt2.cloneNode(true));
                            compareTeam2.appendChild(opt2.cloneNode(true));
                        });
                    }
                    loadTeamMembers();
                }

                // Opret team
                document.getElementById('createTeamForm').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const name = document.getElementById('teamName').value.trim();
                    if (!name) return;
                    await _supabase.from('TEAMS').insert([{ navn: name }]);
                    document.getElementById('teamName').value = '';
                    loadTeams();
                });

                // Tildel medarbejder til team
                document.getElementById('assignForm').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const teamId = document.getElementById('teamSelect').value;
                    const employee = document.getElementById('employeeName').value.trim();
                    if (!teamId || !employee) return;
                    await _supabase.from('TEAM_MEMBERS').insert([{ team_id: teamId, navn: employee }]);
                    document.getElementById('employeeName').value = '';
                    loadTeamMembers();
                });

                // Vis medlemmer for valgt team
                async function loadTeamMembers() {
                    const teamId = document.getElementById('teamSelect').value;
                    if (!teamId) return;
                    const { data: members } = await _supabase.from('TEAM_MEMBERS').select('*').eq('team_id', teamId);
                    const teamMembers = document.getElementById('teamMembers');
                    teamMembers.innerHTML = '<strong>Medlemmer:</strong><br>';
                    if (members && members.length) {
                        members.forEach(m => {
                            teamMembers.innerHTML += m.navn + '<br>';
                        });
                    } else {
                        teamMembers.innerHTML += '<em>Ingen medlemmer</em>';
                    }
                }

                document.getElementById('teamSelect').addEventListener('change', loadTeamMembers);

                // Init
                loadTeams();
        // Menu funktionalitet
        const menuBtn = document.getElementById('menuBtn');
        const sideMenu = document.getElementById('sideMenu');
        menuBtn.addEventListener('click', function() {
            sideMenu.classList.toggle('open');
        });
        document.addEventListener('click', function(e) {
            if (!sideMenu.contains(e.target) && !menuBtn.contains(e.target)) {
                sideMenu.classList.remove('open');
            }
        });
    </script>
</body>
</html>